{"version":3,"file":"index.cjs","sources":["webpack/runtime/define_property_getters","webpack/runtime/has_own_property","webpack/runtime/make_namespace_object","../../src/defineConfig.ts","../../src/constants.ts","../../src/errors.ts","../../src/entryDiscoverer.ts","../../src/entryResolver.ts","../../src/configLoader.ts","../../src/manifestBuilder.ts","../../src/mergeRsbuildConfig.ts","../../src/cliParser.ts"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import type { ExtenzoUserConfig } from \"./types.js\";\r\n\r\nexport function defineConfig(config: ExtenzoUserConfig): ExtenzoUserConfig {\r\n  return config;\r\n}\r\n","/**\r\n * 框架级常量，供 config、discover、manifest、cli 等复用。\r\n * 后续可通过 ExtenzoUserConfig 或环境变量覆盖部分行为。\r\n */\r\n\r\n/** 支持的配置文件名称（按优先级） */\r\nexport const CONFIG_FILES = [\"ext.config.ts\", \"ext.config.js\", \"ext.config.mjs\"] as const;\r\n\r\n/** 入口脚本扩展名（同时存在时优先 .js） */\r\nexport const SCRIPT_EXTS = [\".js\", \".jsx\", \".ts\", \".tsx\"] as const;\r\n\r\n/** 保留入口名（不可自定义命名）：popup / options / sidepanel / background / devtools / content */\r\nexport const RESERVED_ENTRY_NAMES = [\r\n  \"popup\",\r\n  \"options\",\r\n  \"sidepanel\",\r\n  \"background\",\r\n  \"devtools\",\r\n  \"content\",\r\n] as const;\r\n\r\n/** 需要 HTML 的入口名称（popup / options / sidepanel / devtools） */\r\nexport const HTML_ENTRY_NAMES = [\"popup\", \"options\", \"sidepanel\", \"devtools\"] as const;\r\n\r\n/** 仅脚本的入口名称（background / content） */\r\nexport const SCRIPT_ONLY_ENTRY_NAMES = [\"background\", \"content\"] as const;\r\n\r\n/** 构建产物的父目录（输出路径为 outputRoot/outDir，避免根目录下 dist 被 Tailwind v4 等扫描导致循环构建） */\r\nexport const EXTENZO_OUTPUT_ROOT = \".extenzo\";\r\n\r\n/** 默认输出目录名（位于 outputRoot 下，用户可自定义 outDir） */\r\nexport const DEFAULT_OUT_DIR = \"dist\";\r\n\r\n/** 默认源码目录（相对 root） */\r\nexport const DEFAULT_SRC_DIR = \".\";\r\n\r\n/** 开发模式 HMR WebSocket 端口 */\r\nexport const HMR_WS_PORT = 23333;\r\n\r\n/** 默认目标浏览器 */\r\nexport const DEFAULT_BROWSER = \"chromium\" as const;\r\n\r\n/** 支持的浏览器目标 */\r\nexport const SUPPORTED_BROWSERS = [\"chromium\", \"firefox\"] as const;\r\n\r\nexport type BrowserTarget = (typeof SUPPORTED_BROWSERS)[number];\r\n\r\n/** CLI 支持的命令 */\r\nexport const CLI_COMMANDS = [\"dev\", \"build\"] as const;\r\n\r\nexport type CliCommand = (typeof CLI_COMMANDS)[number];\r\n\r\n/** manifest 中各入口产出路径（相对 outDir） */\r\nexport const MANIFEST_ENTRY_PATHS = {\r\n  background: \"background/index.js\",\r\n  content: \"content/index.js\",\r\n  contentScripts: [{ matches: [\"<all_urls>\"], js: [\"content/index.js\"], run_at: \"document_start\" }],\r\n  popup: \"popup/index.html\",\r\n  options: \"options/index.html\",\r\n  optionsOpenInTab: true,\r\n  sidepanel: \"sidepanel/index.html\",\r\n  devtools: \"devtools/index.html\",\r\n} as const;\r\n","/**\n * 统一错误类型与错误输出，便于定位问题。\n */\n\nexport const EXTENZO_ERROR_CODES = {\n  CONFIG_NOT_FOUND: \"EXTENZO_CONFIG_NOT_FOUND\",\n  CONFIG_LOAD_FAILED: \"EXTENZO_CONFIG_LOAD_FAILED\",\n  MANIFEST_MISSING: \"EXTENZO_MANIFEST_MISSING\",\n  NO_ENTRIES: \"EXTENZO_NO_ENTRIES\",\n  INVALID_BROWSER: \"EXTENZO_INVALID_BROWSER\",\n  UNKNOWN_COMMAND: \"EXTENZO_UNKNOWN_COMMAND\",\n  RSBUILD_CONFIG_ERROR: \"EXTENZO_RSBUILD_CONFIG_ERROR\",\n  BUILD_ERROR: \"EXTENZO_BUILD_ERROR\",\n  ZIP_OUTPUT: \"EXTENZO_ZIP_OUTPUT\",\n  ZIP_ARCHIVE: \"EXTENZO_ZIP_ARCHIVE\",\n} as const;\n\nexport type ExtenzoErrorCode = (typeof EXTENZO_ERROR_CODES)[keyof typeof EXTENZO_ERROR_CODES];\n\nexport class ExtenzoError extends Error {\n  readonly code: ExtenzoErrorCode;\n  readonly details?: string;\n  readonly hint?: string;\n\n  constructor(\n    message: string,\n    options: { code: ExtenzoErrorCode; details?: string; hint?: string; cause?: unknown }\n  ) {\n    super(message);\n    this.name = \"ExtenzoError\";\n    this.code = options.code;\n    this.details = options.details;\n    this.hint = options.hint;\n    if (options.cause !== undefined) (this as Error & { cause?: unknown }).cause = options.cause;\n  }\n}\n\nfunction formatError(err: unknown): string {\n  if (err instanceof ExtenzoError) {\n    const parts = [`[${err.code}] ${err.message}`];\n    if (err.details) parts.push(`  详情: ${err.details}`);\n    if (err.hint) parts.push(`  建议: ${err.hint}`);\n    return parts.join(\"\\n\");\n  }\n  if (err instanceof Error) return err.stack ?? err.message;\n  return String(err);\n}\n\n/**\n * 向 stderr 输出错误信息并退出进程。\n * 用于 CLI 顶层 catch，保证错误原因清晰。\n */\nexport function exitWithError(err: unknown, exitCode = 1): never {\n  console.error(\"\\n\" + formatError(err));\n  process.exit(exitCode);\n}\n\nexport function createConfigNotFoundError(root: string): ExtenzoError {\n  return new ExtenzoError(\"未找到 extenzo 配置文件\", {\n    code: EXTENZO_ERROR_CODES.CONFIG_NOT_FOUND,\n    details: `在目录 ${root} 下未找到 ext.config.ts、ext.config.js 或 ext.config.mjs`,\n    hint: \"请在项目根目录执行命令，或新建 ext.config.ts / ext.config.js\",\n  });\n}\n\nexport function createConfigLoadError(filePath: string, cause: unknown): ExtenzoError {\n  const message = cause instanceof Error ? cause.message : String(cause);\n  return new ExtenzoError(\"加载配置文件失败\", {\n    code: EXTENZO_ERROR_CODES.CONFIG_LOAD_FAILED,\n    details: `文件: ${filePath}，错误: ${message}`,\n    hint: \"检查 ext.config 语法与依赖是否正确\",\n    cause: cause instanceof Error ? cause : undefined,\n  });\n}\n\nexport function createManifestMissingError(): ExtenzoError {\n  return new ExtenzoError(\"配置中缺少 manifest 字段\", {\n    code: EXTENZO_ERROR_CODES.MANIFEST_MISSING,\n    details: \"defineConfig 返回的对象必须包含 manifest（或 chromium / firefox 分支）\",\n    hint: \"在 ext.config 中添加 manifest: { name, version, manifest_version, ... }\",\n  });\n}\n\nexport function createNoEntriesError(srcDir: string): ExtenzoError {\n  return new ExtenzoError(\"未发现任何入口\", {\n    code: EXTENZO_ERROR_CODES.NO_ENTRIES,\n    details: `在 ${srcDir} 下未找到 background、content、popup、options 或 sidepanel 任一入口`,\n    hint: \"至少需要其一目录，且包含 index.ts / index.js 等入口文件\",\n  });\n}\n\nexport function createInvalidBrowserError(value: string): ExtenzoError {\n  return new ExtenzoError(\"不支持的浏览器参数\", {\n    code: EXTENZO_ERROR_CODES.INVALID_BROWSER,\n    details: `当前值: \"${value}\"`,\n    hint: \"请使用 -b chrome 或 -b firefox，不传时默认 chrome\",\n  });\n}\n\nexport function createUnknownCommandError(cmd: string): ExtenzoError {\n  return new ExtenzoError(\"未知命令\", {\n    code: EXTENZO_ERROR_CODES.UNKNOWN_COMMAND,\n    details: `命令: \"${cmd}\"`,\n    hint: \"支持: extenzo dev | extenzo build [-b chrome|firefox]\",\n  });\n}\n","import { resolve } from \"path\";\nimport { existsSync, statSync } from \"fs\";\nimport type { EntryInfo } from \"./types.js\";\nimport {\n  SCRIPT_EXTS,\n  HTML_ENTRY_NAMES,\n  SCRIPT_ONLY_ENTRY_NAMES,\n} from \"./constants.js\";\n\nfunction findScriptInDir(dir: string, scriptExts: readonly string[]): string | undefined {\n  for (const ext of scriptExts) {\n    const p = resolve(dir, `index${ext}`);\n    if (existsSync(p)) return p;\n  }\n  return undefined;\n}\n\nfunction hasIndexHtml(dir: string): boolean {\n  return existsSync(resolve(dir, \"index.html\"));\n}\n\n/** 入口发现器：在指定目录下发现 background、content、popup、options、sidepanel、devtools 入口。 */\nexport class EntryDiscoverer {\n  constructor(\n    private readonly scriptExts: readonly string[] = SCRIPT_EXTS,\n    private readonly scriptOnlyNames: readonly string[] = SCRIPT_ONLY_ENTRY_NAMES,\n    private readonly htmlEntryNames: readonly string[] = HTML_ENTRY_NAMES\n  ) {}\n\n  discover(baseDir: string): EntryInfo[] {\n    const entries: EntryInfo[] = [];\n    for (const name of this.scriptOnlyNames) {\n      const dir = resolve(baseDir, name);\n      if (!existsSync(dir) || !statSync(dir).isDirectory()) continue;\n      const scriptPath = findScriptInDir(dir, this.scriptExts);\n      if (scriptPath) entries.push({ name, scriptPath });\n    }\n    for (const name of this.htmlEntryNames) {\n      const dir = resolve(baseDir, name);\n      if (!existsSync(dir) || !statSync(dir).isDirectory()) continue;\n      const scriptPath = findScriptInDir(dir, this.scriptExts);\n      if (!scriptPath) continue;\n      const htmlPath = hasIndexHtml(dir) ? resolve(dir, \"index.html\") : undefined;\n      entries.push({ name, scriptPath, htmlPath });\n    }\n    return entries;\n  }\n\n  getHtmlEntryNames(): string[] {\n    return [...this.htmlEntryNames];\n  }\n\n  getScriptOnlyEntryNames(): string[] {\n    return [...this.scriptOnlyNames];\n  }\n}\n\nconst defaultDiscoverer = new EntryDiscoverer();\n\nexport function discoverEntries(baseDir: string): EntryInfo[] {\n  return defaultDiscoverer.discover(baseDir);\n}\n\nexport function getHtmlEntryNames(): string[] {\n  return defaultDiscoverer.getHtmlEntryNames();\n}\n\nexport function getScriptOnlyEntryNames(): string[] {\n  return defaultDiscoverer.getScriptOnlyEntryNames();\n}\n","import { resolve, dirname, basename } from \"path\";\nimport { existsSync } from \"fs\";\nimport type { ExtenzoUserConfig, EntryInfo } from \"./types.js\";\nimport { HTML_ENTRY_NAMES, SCRIPT_EXTS } from \"./constants.js\";\nimport { EntryDiscoverer } from \"./entryDiscoverer.js\";\n\nconst HTML_ENTRY_SET = new Set(HTML_ENTRY_NAMES);\n\nfunction isHtmlPath(pathStr: string): boolean {\n  return pathStr.trim().toLowerCase().endsWith(\".html\");\n}\n\nfunction isScriptPath(pathStr: string): boolean {\n  const lower = pathStr.trim().toLowerCase();\n  return SCRIPT_EXTS.some((ext) => lower.endsWith(ext));\n}\n\nfunction findScriptInDir(dir: string): string | undefined {\n  for (const ext of SCRIPT_EXTS) {\n    const p = resolve(dir, `index${ext}`);\n    if (existsSync(p)) return p;\n  }\n  return undefined;\n}\n\nfunction findScriptForHtmlDir(dir: string, htmlFilename: string): string | undefined {\n  const indexScript = findScriptInDir(dir);\n  if (indexScript) return indexScript;\n  const stem = basename(htmlFilename, \".html\");\n  for (const ext of SCRIPT_EXTS) {\n    const p = resolve(dir, `${stem}${ext}`);\n    if (existsSync(p)) return p;\n  }\n  return undefined;\n}\n\n/**\n * 入口解析器：默认发现 popup/options/background 等，config.entry 为覆盖逻辑。\n * - 先按目录发现默认入口（background、content、popup、options、sidepanel、devtools）。\n * - 若存在 config.entry，则仅对其中出现的 key 用用户配置覆盖或追加；未出现的 key 仍用默认发现结果。\n * - value 为 .html：按 popup/options 处理（HTML 入口，同目录找脚本）。\n * - value 为 .js/.ts 等：按 background/content 处理（仅脚本入口；仅保留名 popup/options/sidepanel/devtools 时推断同目录 index.html）。\n */\nexport class EntryResolver {\n  constructor(private readonly discoverer: EntryDiscoverer = new EntryDiscoverer()) {}\n\n  resolve(\n    config: Pick<ExtenzoUserConfig, \"entry\" | \"srcDir\">,\n    _root: string,\n    baseDir: string\n  ): EntryInfo[] {\n    const defaultEntries = this.discoverer.discover(baseDir);\n    const entryMap = new Map<string, EntryInfo>(defaultEntries.map((e) => [e.name, e]));\n\n    const entryConfig = config.entry;\n    if (entryConfig && Object.keys(entryConfig).length > 0) {\n      for (const [name, pathStr] of Object.entries(entryConfig)) {\n        const resolved = this.resolveOne(baseDir, name, pathStr);\n        if (resolved) entryMap.set(name, resolved);\n      }\n    }\n\n    return Array.from(entryMap.values());\n  }\n\n  /** 解析单个 entry 配置项，返回 null 表示路径不存在或无法解析 */\n  private resolveOne(baseDir: string, name: string, pathStr: string): EntryInfo | null {\n    const resolved = resolve(baseDir, pathStr);\n    if (!existsSync(resolved)) return null;\n\n    if (isHtmlPath(pathStr)) {\n      const htmlPath = resolved;\n      const dir = dirname(htmlPath);\n      const scriptPath = findScriptForHtmlDir(dir, basename(htmlPath));\n      if (!scriptPath) return null;\n      return { name, scriptPath, htmlPath };\n    }\n    if (isScriptPath(pathStr)) {\n      const scriptPath = resolved;\n      const htmlPath = this.inferHtmlPathForReservedName(name, scriptPath);\n      return { name, scriptPath, htmlPath };\n    }\n    return null;\n  }\n\n  /** 仅对 popup/options/sidepanel/devtools 在脚本路径下推断同目录 index.html */\n  private inferHtmlPathForReservedName(entryName: string, scriptPath: string): string | undefined {\n    if (!HTML_ENTRY_SET.has(entryName as (typeof HTML_ENTRY_NAMES)[number])) return undefined;\n    const dir = dirname(scriptPath);\n    const htmlPath = resolve(dir, \"index.html\");\n    return existsSync(htmlPath) ? htmlPath : undefined;\n  }\n}\n\nconst defaultResolver = new EntryResolver();\n\nexport function resolveEntries(\n  config: Pick<ExtenzoUserConfig, \"entry\" | \"srcDir\">,\n  root: string,\n  baseDir: string\n): EntryInfo[] {\n  return defaultResolver.resolve(config, root, baseDir);\n}\n","import { createRequire } from \"module\";\nimport { resolve } from \"path\";\nimport { existsSync } from \"fs\";\nimport type { ExtenzoUserConfig, ExtenzoResolvedConfig } from \"./types.js\";\nimport type { EntryInfo } from \"./types.js\";\nimport {\n  CONFIG_FILES,\n  DEFAULT_OUT_DIR,\n  DEFAULT_SRC_DIR,\n  EXTENZO_OUTPUT_ROOT,\n} from \"./constants.js\";\nimport {\n  createConfigLoadError,\n  createConfigNotFoundError,\n  createManifestMissingError,\n  createNoEntriesError,\n} from \"./errors.js\";\nimport { EntryDiscoverer } from \"./entryDiscoverer.js\";\nimport { EntryResolver } from \"./entryResolver.js\";\n\nconst require = createRequire(\n  typeof __filename !== \"undefined\" ? __filename : import.meta.url\n);\n\n/** 配置加载器：从项目根目录加载 ext.config 并解析为完整配置与入口列表。 */\nexport class ConfigLoader {\n  constructor(\n    private readonly configFiles: readonly string[] = CONFIG_FILES,\n    private readonly entryResolver: EntryResolver = new EntryResolver(),\n    private readonly entryDiscoverer: EntryDiscoverer = new EntryDiscoverer()\n  ) {}\n\n  loadConfigFile(root: string): ExtenzoUserConfig | null {\n    for (const file of this.configFiles) {\n      const p = resolve(root, file);\n      if (!existsSync(p)) continue;\n      try {\n        const jiti = require(\"jiti\")(root, { esmResolve: true });\n        const mod = jiti(p);\n        return mod.default ?? mod;\n      } catch (e) {\n        throw createConfigLoadError(p, e);\n      }\n    }\n    return null;\n  }\n\n  resolve(root: string): {\n    config: ExtenzoResolvedConfig;\n    baseEntries: EntryInfo[];\n    entries: EntryInfo[];\n  } {\n    const user = this.loadConfigFile(root);\n    if (!user) throw createConfigNotFoundError(root);\n    if (!user.manifest) throw createManifestMissingError();\n\n    const srcDir = resolve(root, user.srcDir ?? DEFAULT_SRC_DIR);\n    const outDir = user.outDir ?? DEFAULT_OUT_DIR;\n    const outputRoot = user.outputRoot ?? EXTENZO_OUTPUT_ROOT;\n    const config: ExtenzoResolvedConfig = { ...user, srcDir, outDir, outputRoot, root };\n    const baseDir = srcDir;\n    const baseEntries = this.entryDiscoverer.discover(baseDir);\n    const entries = this.entryResolver.resolve(user, root, baseDir);\n    if (entries.length === 0) throw createNoEntriesError(baseDir);\n    return { config, baseEntries, entries };\n  }\n}\n\nconst defaultLoader = new ConfigLoader();\n\nexport function loadConfigFile(root: string): ExtenzoUserConfig | null {\n  return defaultLoader.loadConfigFile(root);\n}\n\nexport function resolveExtenzoConfig(root: string): {\n  config: ExtenzoResolvedConfig;\n  baseEntries: EntryInfo[];\n  entries: EntryInfo[];\n} {\n  return defaultLoader.resolve(root);\n}\n","import type { ManifestConfig, EntryInfo } from \"./types.js\";\nimport { MANIFEST_ENTRY_PATHS } from \"./constants.js\";\nimport type { BrowserTarget } from \"./constants.js\";\n\nfunction isChromiumFirefoxManifest(\n  m: ManifestConfig\n): m is { chromium?: Record<string, unknown>; firefox?: Record<string, unknown> } {\n  return typeof m === \"object\" && m !== null && (\"chromium\" in m || \"firefox\" in m);\n}\n\nfunction buildForBrowser(\n  manifest: Record<string, unknown>,\n  entries: EntryInfo[],\n  _browser: BrowserTarget\n): Record<string, unknown> {\n  const out: Record<string, unknown> = { ...manifest };\n  if (entries.some((e) => e.name === \"background\")) {\n    (out as Record<string, unknown>).background = {\n      service_worker: MANIFEST_ENTRY_PATHS.background,\n    };\n  }\n  if (entries.some((e) => e.name === \"content\")) {\n    (out as Record<string, unknown>).content_scripts = MANIFEST_ENTRY_PATHS.contentScripts;\n  }\n  if (entries.some((e) => e.name === \"popup\")) {\n    (out as Record<string, unknown>).action = (out as Record<string, unknown>).action || {};\n    const action = (out as Record<string, unknown>).action as Record<string, unknown>;\n    action.default_popup = MANIFEST_ENTRY_PATHS.popup;\n  }\n  if (entries.some((e) => e.name === \"options\")) {\n    (out as Record<string, unknown>).options_ui = {\n      page: MANIFEST_ENTRY_PATHS.options,\n      open_in_tab: MANIFEST_ENTRY_PATHS.optionsOpenInTab,\n    };\n  }\n  if (entries.some((e) => e.name === \"sidepanel\")) {\n    (out as Record<string, unknown>).side_panel = {\n      default_path: MANIFEST_ENTRY_PATHS.sidepanel,\n    };\n  }\n  if (entries.some((e) => e.name === \"devtools\")) {\n    (out as Record<string, unknown>).devtools_page = MANIFEST_ENTRY_PATHS.devtools;\n  }\n  return out;\n}\n\n/** Manifest 构建器：根据配置与入口生成各浏览器下的 manifest 对象。 */\nexport class ManifestBuilder {\n  buildForBrowser(\n    config: ManifestConfig,\n    entries: EntryInfo[],\n    browser: BrowserTarget\n  ): Record<string, unknown> {\n    const base = isChromiumFirefoxManifest(config)\n      ? browser === \"firefox\"\n        ? (config.firefox ?? config.chromium ?? {})\n        : (config.chromium ?? config.firefox ?? {})\n      : (config as Record<string, unknown>);\n    return buildForBrowser(base as Record<string, unknown>, entries, browser);\n  }\n\n  buildForChromium(config: ManifestConfig, entries: EntryInfo[]): Record<string, unknown> {\n    return this.buildForBrowser(config, entries, \"chromium\");\n  }\n\n  buildForFirefox(config: ManifestConfig, entries: EntryInfo[]): Record<string, unknown> {\n    return this.buildForBrowser(config, entries, \"firefox\");\n  }\n}\n\nconst defaultBuilder = new ManifestBuilder();\n\nexport function resolveManifestChromium(\n  config: ManifestConfig,\n  entries: EntryInfo[]\n): Record<string, unknown> {\n  return defaultBuilder.buildForChromium(config, entries);\n}\n\nexport function resolveManifestFirefox(\n  config: ManifestConfig,\n  entries: EntryInfo[]\n): Record<string, unknown> {\n  return defaultBuilder.buildForFirefox(config, entries);\n}\n","import type { RsbuildConfig } from \"@rsbuild/core\";\r\n\r\nfunction isPlainObject(v: unknown): v is Record<string, unknown> {\r\n  return typeof v === \"object\" && v !== null && !Array.isArray(v);\r\n}\r\n\r\n/**\r\n * Deep-merge user rsbuildConfig into base.\r\n * plugins arrays are concatenated (base.plugins then user.plugins); other keys deep-merge with user winning.\r\n */\r\nexport function mergeRsbuildConfig(\r\n  base: RsbuildConfig,\r\n  user: RsbuildConfig\r\n): RsbuildConfig {\r\n  const result = { ...base };\r\n\r\n  for (const key of Object.keys(user) as (keyof RsbuildConfig)[]) {\r\n    const baseVal = (base as Record<string, unknown>)[key];\r\n    const userVal = (user as Record<string, unknown>)[key];\r\n    if (key === \"plugins\") {\r\n      const basePlugins = Array.isArray(baseVal) ? baseVal : [];\r\n      const userPlugins = Array.isArray(userVal) ? userVal : [];\r\n      (result as Record<string, unknown>)[key] = [...basePlugins, ...userPlugins];\r\n      continue;\r\n    }\r\n    if (isPlainObject(baseVal) && isPlainObject(userVal)) {\r\n      (result as Record<string, unknown>)[key] = mergeRsbuildConfig(\r\n        baseVal as RsbuildConfig,\r\n        userVal as RsbuildConfig\r\n      );\r\n      continue;\r\n    }\r\n    if (userVal !== undefined) {\r\n      (result as Record<string, unknown>)[key] = userVal;\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n","import {\r\n  CLI_COMMANDS,\r\n  DEFAULT_BROWSER,\r\n  type BrowserTarget,\r\n  type CliCommand,\r\n} from \"./constants.js\";\r\nimport { createInvalidBrowserError, createUnknownCommandError } from \"./errors.js\";\r\n\r\nconst BROWSER_FLAGS = [\"-b\", \"--browser\"];\r\nconst BROWSER_ALIASES: Record<string, BrowserTarget> = {\r\n  chrome: \"chromium\",\r\n  chromium: \"chromium\",\r\n  firefox: \"firefox\",\r\n};\r\n\r\nexport interface CliParseResult {\r\n  command: CliCommand;\r\n  browser: BrowserTarget;\r\n  unknownBrowser?: string;\r\n}\r\n\r\nfunction parseBrowserValue(value: string): BrowserTarget | null {\r\n  const normalized = value.trim().toLowerCase();\r\n  return BROWSER_ALIASES[normalized] ?? null;\r\n}\r\n\r\n/** CLI 参数解析器：解析 command 与 -b/--browser，无效时抛出 ExtenzoError。 */\r\nexport class CliParser {\r\n  parse(argv: string[]): CliParseResult {\r\n    const cmdRaw = argv[0] ?? \"dev\";\r\n    const command = CLI_COMMANDS.includes(cmdRaw as CliCommand) ? (cmdRaw as CliCommand) : null;\r\n    if (command === null) throw createUnknownCommandError(cmdRaw);\r\n    const { browser, unknown: unknownBrowser } = this.getBrowserFromArgv(argv);\r\n    return { command, browser, unknownBrowser };\r\n  }\r\n\r\n  private getBrowserFromArgv(argv: string[]): { browser: BrowserTarget; unknown?: string } {\r\n    for (let i = 0; i < argv.length; i++) {\r\n      const arg = argv[i];\r\n      if (BROWSER_FLAGS.includes(arg)) {\r\n        const value = argv[i + 1];\r\n        if (value && !value.startsWith(\"-\")) {\r\n          const target = parseBrowserValue(value);\r\n          if (target) return { browser: target };\r\n          return { browser: DEFAULT_BROWSER, unknown: value };\r\n        }\r\n      }\r\n      if (arg.startsWith(\"-b=\") || arg.startsWith(\"--browser=\")) {\r\n        const value = arg.split(\"=\")[1] ?? \"\";\r\n        const target = parseBrowserValue(value);\r\n        if (target) return { browser: target };\r\n        return { browser: DEFAULT_BROWSER, unknown: value };\r\n      }\r\n    }\r\n    return { browser: DEFAULT_BROWSER };\r\n  }\r\n\r\n  assertSupportedBrowser(value: string): asserts value is BrowserTarget {\r\n    const target = parseBrowserValue(value);\r\n    if (target) return;\r\n    throw createInvalidBrowserError(value);\r\n  }\r\n}\r\n\r\nconst defaultParser: CliParser = new CliParser();\r\n\r\nexport function parseCliArgs(argv: string[]): CliParseResult {\r\n  return defaultParser.parse(argv);\r\n}\r\n\r\nexport function assertSupportedBrowser(value: string): asserts value is BrowserTarget {\r\n  defaultParser.assertSupportedBrowser(value);\r\n}\r\n"],"names":["__webpack_require__","definition","key","Object","obj","prop","Symbol","defineConfig","config","CONFIG_FILES","SCRIPT_EXTS","RESERVED_ENTRY_NAMES","HTML_ENTRY_NAMES","SCRIPT_ONLY_ENTRY_NAMES","EXTENZO_OUTPUT_ROOT","DEFAULT_BROWSER","SUPPORTED_BROWSERS","CLI_COMMANDS","MANIFEST_ENTRY_PATHS","EXTENZO_ERROR_CODES","ExtenzoError","Error","message","options","undefined","formatError","err","parts","String","exitWithError","exitCode","console","process","createConfigNotFoundError","root","createConfigLoadError","filePath","cause","createManifestMissingError","createNoEntriesError","srcDir","createInvalidBrowserError","value","createUnknownCommandError","cmd","findScriptInDir","dir","scriptExts","ext","p","resolve","existsSync","hasIndexHtml","EntryDiscoverer","scriptOnlyNames","htmlEntryNames","baseDir","entries","name","statSync","scriptPath","htmlPath","defaultDiscoverer","discoverEntries","getHtmlEntryNames","getScriptOnlyEntryNames","HTML_ENTRY_SET","Set","isHtmlPath","pathStr","isScriptPath","lower","findScriptForHtmlDir","htmlFilename","indexScript","stem","basename","EntryResolver","discoverer","_root","defaultEntries","entryMap","Map","e","entryConfig","resolved","Array","dirname","entryName","defaultResolver","resolveEntries","require","createRequire","__filename","ConfigLoader","configFiles","entryResolver","entryDiscoverer","file","jiti","mod","user","DEFAULT_SRC_DIR","outDir","DEFAULT_OUT_DIR","outputRoot","baseEntries","defaultLoader","loadConfigFile","resolveExtenzoConfig","isChromiumFirefoxManifest","m","buildForBrowser","manifest","_browser","out","action","ManifestBuilder","browser","base","defaultBuilder","resolveManifestChromium","resolveManifestFirefox","isPlainObject","v","mergeRsbuildConfig","result","baseVal","userVal","basePlugins","userPlugins","BROWSER_FLAGS","BROWSER_ALIASES","parseBrowserValue","normalized","CliParser","argv","cmdRaw","command","unknownBrowser","i","arg","target","defaultParser","parseCliArgs","assertSupportedBrowser"],"mappings":"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"}