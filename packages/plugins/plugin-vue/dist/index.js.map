{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { createRequire } from \"module\";\r\nimport { resolve } from \"path\";\r\nimport type { RsbuildPluginAPI } from \"@rsbuild/core\";\r\n\r\n/**\r\n * Create require that resolves from app root so @rsbuild/* and @vue/babel-plugin-jsx\r\n * are found in the app's node_modules (e.g. examples/manual-install).\r\n */\r\nfunction createAppRequire(appRoot: string) {\r\n  return createRequire(resolve(appRoot, \"package.json\"));\r\n}\r\n\r\n/** Return Rsbuild plugins to prepend before extenzo-vue (so Vue/Babel are available before plugins init). */\r\nexport function getVueRsbuildPlugins(appRoot: string): unknown[] {\r\n  const appRequire = createAppRequire(appRoot);\r\n  try {\r\n    const { pluginVue } = appRequire(\"@rsbuild/plugin-vue\");\r\n    const { pluginBabel } = appRequire(\"@rsbuild/plugin-babel\");\r\n    return [\r\n      pluginBabel({\r\n        include: /\\.(?:jsx|tsx)$/,\r\n        babelLoaderOptions: (\r\n          opts: Record<string, unknown>,\r\n          utils: { addPlugins?: (plugins: unknown[]) => void }\r\n        ) => {\r\n          if (typeof utils?.addPlugins === \"function\") {\r\n            utils.addPlugins([\"@vue/babel-plugin-jsx\"]);\r\n          } else {\r\n            const list = (opts.plugins as unknown[]) ?? [];\r\n            if (\r\n              !list.some(\r\n                (p) =>\r\n                  (typeof p === \"string\" && p.includes(\"babel-plugin-jsx\")) ||\r\n                  (Array.isArray(p) && String(p[0]).includes(\"babel-plugin-jsx\"))\r\n              )\r\n            ) {\r\n              opts.plugins = [...list, \"@vue/babel-plugin-jsx\"];\r\n            }\r\n          }\r\n          return opts;\r\n        },\r\n      }),\r\n      pluginVue(),\r\n      // pluginVueJsx(),\r\n    ];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Rsbuild plugin for Vue 3 + Vue JSX + Less + Babel.\r\n * Usage: import vue from \"@extenzo/plugin-vue\"; plugins: [vue()]\r\n */\r\nexport function extenzoVuePlugin() {\r\n  return {\r\n    name: \"extenzo-vue\",\r\n    enforce: \"pre\" as const,\r\n    setup() {\r\n      // Vue/Babel plugins are injected by CLI via getVueRsbuildPlugins before createRsbuild.\r\n    },\r\n  };\r\n}\r\n\r\nexport default extenzoVuePlugin;\r\n"],"names":["createAppRequire","appRoot","createRequire","resolve","getVueRsbuildPlugins","appRequire","pluginVue","pluginBabel","opts","utils","list","p","Array","String","extenzoVuePlugin"],"mappings":";;AAQA,SAASA,iBAAiBC,OAAe;IACvC,OAAOC,cAAcC,QAAQF,SAAS;AACxC;AAGO,SAASG,qBAAqBH,OAAe;IAClD,MAAMI,aAAaL,iBAAiBC;IACpC,IAAI;QACF,MAAM,EAAEK,SAAS,EAAE,GAAGD,WAAW;QACjC,MAAM,EAAEE,WAAW,EAAE,GAAGF,WAAW;QACnC,OAAO;YACLE,YAAY;gBACV,SAAS;gBACT,oBAAoB,CAClBC,MACAC;oBAEA,IAAI,AAA6B,cAA7B,OAAOA,OAAO,YAChBA,MAAM,UAAU,CAAC;wBAAC;qBAAwB;yBACrC;wBACL,MAAMC,OAAQF,KAAK,OAAO,IAAkB,EAAE;wBAC9C,IACE,CAACE,KAAK,IAAI,CACR,CAACC,IACE,AAAa,YAAb,OAAOA,KAAkBA,EAAE,QAAQ,CAAC,uBACpCC,MAAM,OAAO,CAACD,MAAME,OAAOF,CAAC,CAAC,EAAE,EAAE,QAAQ,CAAC,sBAG/CH,KAAK,OAAO,GAAG;+BAAIE;4BAAM;yBAAwB;oBAErD;oBACA,OAAOF;gBACT;YACF;YACAF;SAED;IACH,EAAE,OAAM;QACN,OAAO,EAAE;IACX;AACF;AAMO,SAASQ;IACd,OAAO;QACL,MAAM;QACN,SAAS;QACT,UAEA;IACF;AACF;AAEA,YAAeA"}