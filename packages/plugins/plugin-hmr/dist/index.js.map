{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import type { Compiler } from \"@rspack/core\";\nimport { resolve } from \"path\";\nimport { spawn, type ChildProcess } from \"node:child_process\";\nimport { readFile, writeFile, mkdir } from \"node:fs/promises\";\nimport { existsSync, statSync } from \"node:fs\";\nimport { rm } from \"node:fs/promises\";\nimport { tmpdir } from \"os\";\nimport { createServer } from \"node:http\";\nimport { WebSocketServer, WebSocket } from \"ws\";\n\nexport interface HmrPluginOptions {\n  distPath: string;\n  autoOpen?: boolean;\n  browser?: \"chromium\" | \"firefox\";\n  /** Chrome executable path (overrides .env BROWSER_CHROME). From config.launch.chrome. */\n  chromePath?: string;\n  /** Firefox executable path (overrides .env BROWSER_FIREFOX). From config.launch.firefox. */\n  firefoxPath?: string;\n  wsPort?: number;\n  enableReload?: boolean;\n}\n\nlet chromeProcess: ChildProcess | null = null;\nlet firefoxProcess: ChildProcess | null = null;\nlet userDataDir: string | null = null;\nlet reloadManagerPath: string | null = null;\nlet browserLaunched = false;\nlet isCleaningUp = false;\nlet cleanupHandlersRegistered = false;\nlet wsServer: WebSocketServer | null = null;\nlet httpServer: ReturnType<typeof createServer> | null = null;\n\nfunction normalizeForChrome(p: string): string {\n  return p.replace(/\\\\/g, \"/\");\n}\n\nasync function ensureDistReady(distPath: string, timeoutMs = 15000): Promise<boolean> {\n  const manifestPath = resolve(distPath, \"manifest.json\");\n  const start = Date.now();\n  while (Date.now() - start < timeoutMs) {\n    if (existsSync(manifestPath) && statSync(manifestPath).size > 0) return true;\n    await new Promise((r) => setTimeout(r, 300));\n  }\n  throw new Error(`dist not ready: ${manifestPath}`);\n}\n\nasync function getBrowserPath(\n  browser: \"chromium\" | \"firefox\",\n  options: { chromePath?: string; firefoxPath?: string }\n): Promise<string | null> {\n  const fromConfig = browser === \"chromium\" ? options.chromePath : options.firefoxPath;\n  if (fromConfig && fromConfig.trim()) return fromConfig.trim();\n\n  const path = require(\"path\") as typeof import(\"path\");\n  const envPath = path.resolve(process.cwd(), \".env\");\n  if (!existsSync(envPath)) return null;\n  try {\n    const envContent = await readFile(envPath, \"utf-8\");\n    const key = browser === \"chromium\" ? \"BROWSER_CHROME\" : \"BROWSER_FIREFOX\";\n    const match = envContent.match(new RegExp(`^${key}\\\\s*=\\\\s*(.+)$`, \"m\"));\n    if (match) return match[1].trim().replace(/^['\"]|['\"]$/g, \"\");\n  } catch {\n    // ignore\n  }\n  return null;\n}\n\nfunction startWebSocketServer(port: number): WebSocketServer {\n  if (wsServer) return wsServer;\n  httpServer = createServer();\n  wsServer = new WebSocketServer({ server: httpServer });\n  wsServer.on(\"connection\", (ws: WebSocket) => {\n    if (ws.readyState === WebSocket.OPEN) ws.send(\"connected\");\n  });\n  httpServer.listen(port, () => {\n    console.log(`WebSocket started: ws://localhost:${port}`);\n  });\n  return wsServer;\n}\n\nexport function notifyReload(): void {\n  if (!wsServer) return;\n  wsServer.clients.forEach((client: WebSocket) => {\n    if (client.readyState === WebSocket.OPEN) client.send(\"reload-extension\");\n  });\n}\n\nasync function createReloadManagerExtension(wsPort: number): Promise<string> {\n  const extPath = resolve(tmpdir(), \"reload-manager-extension\");\n  const bgJsPath = resolve(extPath, \"bg.js\");\n  const portCachePath = resolve(extPath, \".port-cache\");\n  let needsUpdate = true;\n  if (existsSync(portCachePath)) {\n    try {\n      const cached = parseInt(await readFile(portCachePath, \"utf-8\"), 10);\n      if (cached === wsPort) needsUpdate = false;\n    } catch {\n      // ignore\n    }\n  }\n  await mkdir(extPath, { recursive: true });\n  if (needsUpdate) {\n    await writeFile(\n      resolve(extPath, \"manifest.json\"),\n      JSON.stringify(\n        { manifest_version: 3, name: \"Reload Manager\", version: \"1.0\", permissions: [\"management\", \"tabs\"], background: { service_worker: \"bg.js\" } },\n        null,\n        2\n      ),\n      \"utf-8\"\n    );\n    const bgJs = `\nlet ws=null,rt=null;\nfunction connect(){\n  try{if(ws)ws.close();\n  ws=new WebSocket(\"ws://localhost:${wsPort}\");\n  ws.onopen=()=>{if(rt)clearInterval(rt);rt=null;};\n  ws.onmessage=async(e)=>{\n    if(e.data===\"connected\")return;\n    if(e.data===\"reload-extension\"){\n      const all=await chrome.management.getAll();\n      for(const x of all){\n        if(x.enabled&&x.installType===\"development\"&&x.id!==chrome.runtime.id){\n          try{await chrome.management.setEnabled(x.id,false);\n          await new Promise(r=>setTimeout(r,100));\n          await chrome.management.setEnabled(x.id,true);}catch(err){}\n        }\n      }\n    }\n  };\n  ws.onclose=()=>{if(!rt)rt=setInterval(connect,3000);};\n  }catch(err){}\n}\nconnect();\n`;\n    await writeFile(bgJsPath, bgJs, \"utf-8\");\n    await writeFile(portCachePath, String(wsPort), \"utf-8\");\n  }\n  return extPath;\n}\n\nasync function cleanup(): Promise<void> {\n  if (isCleaningUp) return;\n  isCleaningUp = true;\n  if (chromeProcess && !chromeProcess.killed) {\n    chromeProcess.kill(\"SIGTERM\");\n    await new Promise<void>((r) => {\n      const t = setTimeout(() => {\n        if (chromeProcess && !chromeProcess.killed) chromeProcess.kill(\"SIGKILL\");\n        r();\n      }, 2000);\n      chromeProcess?.on(\"exit\", () => {\n        clearTimeout(t);\n        r();\n      });\n    });\n    chromeProcess = null;\n  }\n  if (firefoxProcess && !firefoxProcess.killed) {\n    firefoxProcess.kill(\"SIGTERM\");\n    firefoxProcess = null;\n  }\n  if (reloadManagerPath && existsSync(reloadManagerPath)) {\n    await rm(reloadManagerPath, { recursive: true, force: true }).catch(() => {});\n    reloadManagerPath = null;\n  }\n  if (userDataDir && existsSync(userDataDir)) {\n    await rm(userDataDir, { recursive: true, force: true }).catch(() => {});\n    userDataDir = null;\n  }\n  if (wsServer) {\n    wsServer.close();\n    wsServer = null;\n  }\n  if (httpServer) {\n    httpServer.close();\n    httpServer = null;\n  }\n}\n\nasync function launchBrowser(options: HmrPluginOptions): Promise<void> {\n  const {\n    distPath,\n    browser = \"chromium\",\n    chromePath,\n    firefoxPath,\n    wsPort = 23333,\n    enableReload = true,\n  } = options;\n  const browserBinary = await getBrowserPath(browser, { chromePath, firefoxPath });\n  if (!browserBinary) {\n    const envKey = browser === \"chromium\" ? \"BROWSER_CHROME\" : \"BROWSER_FIREFOX\";\n    const launchKey = browser === \"chromium\" ? \"launch.chrome\" : \"launch.firefox\";\n    console.warn(\n      `${browser} path not found; set ${launchKey} in ext.config or ${envKey} in .env`\n    );\n    return;\n  }\n  if (browser === \"firefox\") {\n    firefoxProcess = spawn(`web-ext run --source-dir=${distPath} --target firefox-desktop --firefox=\"${browserBinary}\"`, { shell: true, stdio: \"inherit\" });\n    firefoxProcess.on(\"exit\", () => {\n      firefoxProcess = null;\n    });\n    return;\n  }\n  userDataDir = resolve(tmpdir(), `chrome-dev-${Date.now()}`);\n  await mkdir(userDataDir, { recursive: true });\n  await ensureDistReady(distPath).catch((e: Error) => {\n    console.error(e.message);\n  });\n  if (enableReload) {\n    startWebSocketServer(wsPort);\n    reloadManagerPath = await createReloadManagerExtension(wsPort);\n  }\n  const extPathChrome = normalizeForChrome(distPath);\n  const reloadChrome = reloadManagerPath ? normalizeForChrome(reloadManagerPath) : \"\";\n  const args = [\n    `--user-data-dir=${normalizeForChrome(userDataDir)}`,\n    \"--no-first-run\",\n    \"--no-default-browser-check\",\n  ];\n  if (reloadManagerPath) {\n    args.push(`--disable-extensions-except=${extPathChrome},${reloadChrome}`, `--load-extension=${extPathChrome}`, `--load-extension=${reloadChrome}`);\n  } else {\n    args.push(`--load-extension=${extPathChrome}`);\n  }\n  args.push(\"chrome://extensions/\");\n  chromeProcess = spawn(browserBinary, args, { stdio: [\"ignore\", \"ignore\", \"ignore\"] });\n  chromeProcess.on(\"exit\", () => {\n    chromeProcess = null;\n  });\n  console.log(\"Chrome started, extension loaded\");\n}\n\nfunction statsHasErrors(stats: unknown): boolean {\n  if (!stats || typeof stats !== \"object\") return false;\n  const s = stats as { hasErrors?: () => boolean };\n  return Boolean(s.hasErrors?.());\n}\n\n/**\n * Rspack 插件：在 build watch 模式下，首次编译完成后启动浏览器，后续编译触发热重载。\n * 通过 tools.rspack.appendPlugins(hmrPlugin(options)) 注册，确保收到真实 compiler。\n */\nexport function hmrPlugin(options: HmrPluginOptions) {\n  const {\n    distPath,\n    autoOpen = true,\n    browser = (process.env.BROWSER as \"chromium\" | \"firefox\") || \"chromium\",\n    wsPort = 23333,\n    enableReload = true,\n  } = options;\n\n  return {\n    name: \"extenzo-hmr\",\n    apply(compiler: Compiler) {\n      const hooks = compiler?.hooks;\n      if (!hooks?.done) return;\n\n      if (enableReload) {\n        let firstReload = true;\n        hooks.done.tap(\"extenzo-hmr-reload\", async (stats) => {\n          if (firstReload) {\n            firstReload = false;\n            return;\n          }\n          await new Promise((r) => setTimeout(r, 500));\n          notifyReload();\n        });\n      }\n\n      if (!cleanupHandlersRegistered) {\n        cleanupHandlersRegistered = true;\n        const onSignal = () => {\n          cleanup().then(() => process.exit(0)).catch(() => process.exit(1));\n        };\n        process.on(\"SIGINT\", onSignal);\n        process.on(\"SIGTERM\", onSignal);\n      }\n\n      hooks.done.tap(\"extenzo-hmr\", async (stats) => {\n        if (!autoOpen || browserLaunched) return;\n        if (statsHasErrors(stats)) return;\n        browserLaunched = true;\n        await new Promise((r) => setTimeout(r, 1000));\n        try {\n          await launchBrowser({\n            distPath,\n            autoOpen,\n            browser,\n            chromePath: options.chromePath,\n            firefoxPath: options.firefoxPath,\n            wsPort,\n            enableReload,\n          });\n        } catch (e) {\n          console.error(\"Failed to launch browser:\", e);\n        }\n      });\n    },\n  };\n}\n"],"names":["chromeProcess","firefoxProcess","userDataDir","reloadManagerPath","browserLaunched","isCleaningUp","cleanupHandlersRegistered","wsServer","httpServer","normalizeForChrome","p","ensureDistReady","distPath","timeoutMs","manifestPath","resolve","start","Date","existsSync","statSync","Promise","r","setTimeout","Error","getBrowserPath","browser","options","fromConfig","path","require","envPath","process","envContent","readFile","key","match","RegExp","startWebSocketServer","port","createServer","WebSocketServer","ws","WebSocket","console","notifyReload","client","createReloadManagerExtension","wsPort","extPath","tmpdir","bgJsPath","portCachePath","needsUpdate","cached","parseInt","mkdir","writeFile","JSON","bgJs","String","cleanup","t","clearTimeout","rm","launchBrowser","chromePath","firefoxPath","enableReload","browserBinary","envKey","launchKey","spawn","e","extPathChrome","reloadChrome","args","statsHasErrors","stats","s","Boolean","hmrPlugin","autoOpen","compiler","hooks","firstReload","onSignal"],"mappings":"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"}